<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motor de Modelagem Conversacional ParamÃ©trico (CMÂ²)</title>
    <link rel="stylesheet" href="/static/css/style.css?v=20250621">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <!-- Loading progress bar -->
    <style>
        .loading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform: translateX(-100%);
            animation: loading-slide 2s infinite;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(102, 126, 234, 0.2);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        .loading-message {
            text-align: center;
            color: #667eea;
            font-weight: 500;
        }
        
        @keyframes loading-slide {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(0%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body>
    <!-- Loading progress bar -->
    <div class="loading-progress" id="loading-progress"></div>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>CMÂ² - Text-to-CAD</h1>
            <div class="header-info">
                <span id="connection-status" class="status-indicator disconnected"></span>
                <span id="session-info">Conectando...</span>
            </div>
            <div class="model-select">
                <select id="model-select">
                    <option value="gemini-2.5-flash">Gemini Flash</option>
                    <option value="gemini-2.5-pro">Gemini Pro</option>
                </select>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- 3D Viewport -->
            <div class="viewport-panel">
                <div class="panel-header">
                    <h3>ğŸ¯ Viewport 3D</h3>
                    <div class="viewport-controls">
                        <button id="reset-view" class="btn-icon" title="Resetar VisualizaÃ§Ã£o">ğŸ”„</button>
                        <button id="fit-view" class="btn-icon" title="Ajustar Ã  Tela">ğŸ“</button>
                        <button id="export-model" class="btn-icon" title="Exportar Modelo">ğŸ’¾</button>
                        <button id="toggle-wireframe" class="btn-icon" title="Alternar Wireframe">ğŸ”—</button>
                    </div>
                </div>
                <div id="viewport-3d" class="viewport-container">
                    <div class="viewport-overlay">
                        <div class="no-model-message">
                            <p>ğŸ’¬ Comece conversando para criar seu primeiro modelo!</p>
                        </div>
                    </div>
                    <!-- Progress indicator for model generation -->
                    <div class="model-progress" id="model-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <p>Gerando modelo 3D...</p>
                    </div>
                </div>
            </div>

            <!-- Resizer between viewport and side panel -->
            <div class="resizer vertical-resizer" id="main-resizer"></div>

            <!-- Side Panel -->
            <div class="side-panel">
                <!-- Chat Panel -->
                <div class="chat-panel">
                    <div class="panel-header">
                        <h3>ğŸ’­ Conversa de Design</h3>
                        <div class="chat-controls">
                            <button id="toggle-params" class="btn-icon toggle-panel" title="Mostrar/Ocultar ParÃ¢metros" data-target="parameters">âš™ï¸</button>
                            <button id="toggle-timeline" class="btn-icon toggle-panel" title="Mostrar/Ocultar Timeline" data-target="timeline">ğŸ“œ</button>
                            <button id="clear-chat" class="btn-icon" title="Limpar Conversa">ğŸ—‘ï¸</button>
                            <button id="export-chat" class="btn-icon" title="Exportar Conversa">ğŸ“„</button>
                        </div>
                    </div>
                    
                    <div id="chat-messages" class="chat-messages">
                        <div class="system-message message">
                            <div class="message-avatar">ğŸ¤–</div>
                            <div class="message-content">
                                <p>OlÃ¡! Sou seu assistente de design CAD inteligente. Posso ajudÃ¡-lo a criar modelos 3D atravÃ©s de linguagem natural.</p>
                                <p><strong>Exemplos do que posso fazer:</strong></p>
                                <ul>
                                    <li>"Crie um flange circular com 100mm de diÃ¢metro"</li>
                                    <li>"Aumente a altura para 20mm"</li>
                                    <li>"Adicione 4 furos para parafusos M6"</li>
                                    <li>"FaÃ§a um chanfro de 2mm nas bordas"</li>
                                </ul>
                                <p>âœ¨ <em>Dica: Seja especÃ­fico com as dimensÃµes para melhores resultados!</em></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="input-group">
                            <textarea 
                                id="chat-input" 
                                placeholder="Descreva o que quer criar ou modificar..." 
                                maxlength="5000" 
                                rows="1"></textarea>
                            <button id="send-message" class="btn-primary" disabled>
                                <span class="btn-text">âœˆï¸ Enviar</span>
                                <span class="btn-loading" style="display: none;">
                                    <span class="spinner">â³</span> Enviando...
                                </span>
                            </button>
                        </div>
                        <div class="input-helper">
                            <small id="input-counter">0/500</small>
                            <div class="quick-actions">
                                <button class="quick-action" data-text="Crie uma caixa de 50x30x20mm">ğŸ“¦ Caixa</button>
                                <button class="quick-action" data-text="Crie um cilindro com 25mm de raio e 40mm de altura">ğŸ¥« Cilindro</button>
                                <button class="quick-action" data-text="Crie uma esfera com 30mm de raio">âš½ Esfera</button>
                                <button class="quick-action" data-text="Adicione um furo de 5mm no centro">ğŸ•³ï¸ Furo</button>
                                <button class="quick-action" data-text="FaÃ§a um filete de 3mm nas arestas">ğŸ”„ Filete</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resizer between chat and parameters -->
                <div class="resizer horizontal-resizer" id="chat-params-resizer" style="display:none;"></div>

                <!-- Parameters Panel -->
                <div class="parameters-panel hidden" id="parameters-panel">
                    <div class="panel-header">
                        <h3>âš™ï¸ ParÃ¢metros</h3>
                        <div class="panel-controls">
                            <button id="refresh-params" class="btn-icon" title="Atualizar ParÃ¢metros">ğŸ”„</button>
                            <button id="reset-params" class="btn-icon" title="Resetar ParÃ¢metros">â†©ï¸</button>
                            <button id="collapse-params" class="btn-icon collapse-btn" title="Recolher">â¬‡ï¸</button>
                        </div>
                    </div>
                    <div id="parameters-list" class="parameters-list">
                        <div class="no-parameters">
                            <p>ğŸ›ï¸ Nenhum parÃ¢metro ainda. Crie um modelo para ver os parÃ¢metros configurÃ¡veis!</p>
                        </div>
                    </div>
                </div>

                <!-- Resizer between parameters and timeline -->
                <div class="resizer horizontal-resizer" id="params-timeline-resizer" style="display:none;"></div>

                <!-- Timeline Panel -->
                <div class="timeline-panel hidden" id="timeline-panel">
                    <div class="panel-header">
                        <h3>ğŸ“œ Linha do Tempo</h3>
                        <div class="panel-controls">
                            <button id="refresh-timeline" class="btn-icon" title="Atualizar Timeline">ğŸ”„</button>
                            <button id="undo-last" class="btn-icon" title="Desfazer Ãšltima OperaÃ§Ã£o">â†¶</button>
                            <button id="collapse-timeline" class="btn-icon collapse-btn" title="Recolher">â¬‡ï¸</button>
                        </div>
                    </div>
                    <div id="operations-timeline" class="operations-timeline">
                        <div class="no-operations">
                            <p>ğŸ“‹ Nenhuma operaÃ§Ã£o ainda. As operaÃ§Ãµes aparecerÃ£o aqui conforme vocÃª cria o modelo.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-info">
                <span id="model-stats">ğŸš€ Pronto para comeÃ§ar</span>
            </div>
            <div class="processing-indicator" id="processing-indicator" style="display: none;">
                <span class="spinner">âš¡</span>
                <span id="processing-text">Processando...</span>
            </div>
            <div class="app-version">
                <small>CMÂ² v2.0 | IA AvanÃ§ada</small>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <div id="error-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>âŒ Erro</h3>
            <p id="error-message"></p>
            <div class="modal-actions">
                <button id="close-error" class="btn-primary">OK</button>
                <button id="report-error" class="btn-secondary">ğŸ“ Reportar</button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>âœ… Sucesso</h3>
            <p id="success-message"></p>
            <button id="close-success" class="btn-primary">Ã“timo!</button>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="context-menu" class="context-menu" style="display: none;">
        <div class="context-item" data-action="copy">ğŸ“‹ Copiar</div>
        <div class="context-item" data-action="edit">âœï¸ Editar</div>
        <div class="context-item" data-action="delete">ğŸ—‘ï¸ Deletar</div>
    </div>

    <!-- Floating Action Button (FAB) -->
    <div class="fab-container">
        <button id="fab-main" class="fab" title="AÃ§Ãµes RÃ¡pidas">
            <span class="fab-icon">âœ¨</span>
        </button>
        <div class="fab-menu" id="fab-menu">
            <button class="fab-item" data-action="new-model" title="Novo Modelo">ğŸ†•</button>
            <button class="fab-item" data-action="save-model" title="Salvar Modelo">ğŸ’¾</button>
            <button class="fab-item" data-action="share-model" title="Compartilhar">ğŸ”—</button>
            <button class="fab-item" data-action="help" title="Ajuda">â“</button>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Remove loading progress bar when page loads
        window.addEventListener('load', () => {
            const loadingProgress = document.getElementById('loading-progress');
            if (loadingProgress) {
                setTimeout(() => {
                    loadingProgress.style.display = 'none';
                }, 1000);
            }
        });

        // Auto-resize textarea
        function autoResizeTextarea() {
            const textarea = document.getElementById('chat-input');
            if (textarea) {
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                });
            }
        }

        // Initialize auto-resize when DOM is ready
        document.addEventListener('DOMContentLoaded', autoResizeTextarea);
    </script>

    <script src="/static/js/three-setup.js?v=20250625"></script>
    <script src="/static/js/websocket-client.js?v=20250625"></script>
    <script src="/static/js/ui-controls.js?v=20250625"></script>
    <script src="/static/js/app.js?v=20250625"></script>
</body>
</html> 